## –û—Å–Ω–æ–≤—ã SQL –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (–°–£–ë–î)** ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ:

* –•—Ä–∞–Ω–∏—Ç, –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–º–∏
* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

**PostgreSQL** ‚Äî —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –°–£–ë–î, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏.
–û–Ω–∞:

* –û—Ç–∫—Ä—ã—Ç–∞—è –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
* –ò–º–µ–µ—Ç –º–æ—â–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç–∏–ø–æ–≤, –∏–Ω–¥–µ–∫—Å–æ–≤, —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤, —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

| **–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö**          | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                                    | **–ü—Ä–∏–º–µ—Ä**                                |
|-------------------------|---------------------------------------------------|-------------------------------------------|
| INTEGER / INT           | –¶–µ–ª—ã–µ —á–∏—Å–ª–∞                                       | 42, -7                                    |
| SERIAL                  | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π INTEGER (—É–¥–æ–±–µ–Ω –¥–ª—è PRIMARY KEY) | id SERIAL PRIMARY KEY                     |
| BIGINT                  | –ë–æ–ª—å—à–∏–µ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ (64-–±–∏—Ç)                      | 9223372036854775807                       |
| NUMERIC(p,s) / DECIMAL  | –¢–æ—á–Ω—ã–µ —á–∏—Å–ª–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é            | NUMERIC(10,2) ‚Üí 12345.67                  |
| REAL / DOUBLE PRECISION | –ß–∏—Å–ª–∞ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π                          | 3.14159                                   |
| TEXT                    | –°—Ç—Ä–æ–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã                         | '–ü—Ä–∏–≤–µ—Ç, –ê–ª–µ–∫—Å!'                          |
| VARCHAR(n)              | –°—Ç—Ä–æ–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã                         | VARCHAR(255)                              |
| BOOLEAN                 | –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è                               | TRUE, FALSE                               |
| DATE                    | –î–∞—Ç–∞ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏                                  | '2025-10-24'                              |
| TIME                    | –í—Ä–µ–º—è –±–µ–∑ –¥–∞—Ç—ã                                    | '14:30:00'                                |
| TIMESTAMPTZ             | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å —Ç–∞–π–º–∑–æ–Ω–æ–π                          | '2025-10-24 14:30:00+02'                  |
| TIMESTAMP               | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è                                      | '2025-10-24 14:30:00'                     |
| INTERVAL                | –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏                                 | '2 days 3 hours'                          |
| JSON                    | –•—Ä–∞–Ω–µ–Ω–∏–µ JSON –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏                      | '{"name": "Alex"}'                        |
| JSONB                   | –ë–∏–Ω–∞—Ä–Ω—ã–π JSON —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏           | '{"active": true, "score": 42}'           |
| UUID                    | –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã                         | '550e8400-e29b-41d4-a716-446655440000'    |
| ARRAY                   | –ú–∞—Å—Å–∏–≤—ã –∑–Ω–∞—á–µ–Ω–∏–π                                  | TEXT[], INTEGER[]                         |
| BYTEA                   | –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ                                   | –§–∞–π–ª—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è                        |
| ENUM                    | –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π)        | CREATE TYPE mood AS ENUM ('happy', 'sad') |

## –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

````sql
CREATE TABLE users
(
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name        TEXT        NOT NULL,
    email       TEXT UNIQUE NOT NULL,
    is_active   BOOLEAN          DEFAULT TRUE,
    created_at  TIMESTAMPTZ      DEFAULT now(),
    preferences JSONB
);
````

üì• INSERT ‚Äî –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

````sql
INSERT INTO users (name, email)
VALUES ('–ê–ª–µ–∫—Å', 'alex@example.com');
````

üì§ SELECT ‚Äî –≤—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

````sql
SELECT id, name
FROM users;
````

‚úèÔ∏è UPDATE ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

````sql
UPDATE users
SET name = '–ê–ª–µ–∫—Å–µ–π'
WHERE id = 1;
````

‚ùå DELETE ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

````sql
DELETE
FROM users
WHERE id = 1;
````

–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:

````sql
SELECT *
FROM users
WHERE is_active = TRUE
ORDER BY created_at DESC LIMIT 5;
````

üßÆ GROUP BY ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞

````sql
SELECT user_id, COUNT(*) AS order_count
FROM orders
GROUP BY user_id;
````

üß™ HAVING ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –∞–≥—Ä–µ–≥–∞—Ç–∞–º

````sql
SELECT user_id, COUNT(*) AS order_count
FROM orders
GROUP BY user_id
HAVING COUNT(*) > 5;
````

–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ

````sql
SELECT users.name, orders.total
FROM users
         JOIN orders ON users.id = orders.user_id;
````

üß≠ LEFT JOIN ‚Äî –≤—Å–µ –∏–∑ –ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã + —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

````sql
SELECT users.name, orders.total
FROM users
         LEFT JOIN orders ON users.id = orders.user_id;
````

| **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** | **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**                | **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**          |
|----------------|-------------------------------|--------------------------|
| –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                    | –ü—Ä–∏–º–µ—Ä                   |
| WHERE          | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫              | WHERE is_active = TRUE   |
| ORDER BY       | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞                    | ORDER BY created_at DESC |
| LIMIT          | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫  | LIMIT 10                 |
| OFFSET         | –ü—Ä–æ–ø—É—Å–∫ —Å—Ç—Ä–æ–∫ (–¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏) | LIMIT 10 OFFSET 20       |

–ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á

````sql
CREATE TABLE users
(
    id    SERIAL PRIMARY KEY,
    name  TEXT,
    email TEXT
);
````

–í–Ω–µ—à–Ω–∏–π –∫–ª—é—á

````sql
CREATE TABLE orders
(
    id      SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users (id),
    total   NUMERIC
);
````

–ü—Ä–∏–º–µ—Ä —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º:

````sql
CREATE TABLE orders
(
    id      SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users (id) ON DELETE CASCADE,
    total   NUMERIC
);
````

JSONB –∏ –∑–∞–ø—Ä–æ—Å—ã

* -> ‚Äî –¥–æ—Å—Ç—É–ø –∫ –≤–ª–æ–∂–µ–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON):

````sql
SELECT data - > 'user'
FROM logs;
````

* ->> ‚Äî –¥–æ—Å—Ç—É–ø –∫ –∑–Ω–∞—á–µ–Ω–∏—é –∫–∞–∫ —Ç–µ–∫—Å—Ç:

````sql
SELECT data - > 'user' ->>'name'
FROM logs;
````

* @> ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è:

````sql
SELECT *
FROM logs
WHERE data @ > '{"user": {"active": true}}';
````

* jsonb_path_query ‚Äî –º–æ—â–Ω—ã–π JSONPath:

````sql
SELECT jsonb_path_query(data, '$.user[*] ? (@.score > 50)');
````

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ best practices

| –î–µ–π—Å—Ç–≤–∏–µ                      | –ü—Ä–∏–º–µ—Ä                                                                                            |
|-------------------------------|---------------------------------------------------------------------------------------------------|
| ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü            | ALTER TABLE users ADD COLUMN age INTEGER;                                                         |
| ‚ùå –£–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü             | ALTER TABLE users DROP COLUMN age;                                                                |
| ‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Å—Ç–æ–ª–±–µ—Ü      | ALTER TABLE users RENAME COLUMN age TO user_age;                                                  |
| üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø               | ALTER TABLE users ALTER COLUMN age TYPE TEXT;                                                     |
| üßº –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å NOT NULL | ALTER TABLE users ALTER COLUMN age SET NOT NULL;                                                  |
| üß™ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å DEFAULT  | ALTER TABLE users ALTER COLUMN age SET DEFAULT 18;                                                |
| üßπ –£–¥–∞–ª–∏—Ç—å DEFAULT            | ALTER TABLE users ALTER COLUMN age DROP DEFAULT;                                                  |
| ‚úèÔ∏è–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É       | ALTER TABLE users RENAME TO customers;                                                            |
| üîÑ –ò–∑–º–µ–Ω–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞         | ALTER TABLE users OWNER TO admin;                                                                 |
| üß≠ –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –¥—Ä—É–≥—É—é —Å—Ö–µ–º—É | ALTER TABLE users SET SCHEMA archive;                                                             |
| ‚ûï –î–æ–±–∞–≤–∏—Ç—å PRIMARY KEY        | ALTER TABLE users ADD PRIMARY KEY (id);                                                           |
| ‚ûï –î–æ–±–∞–≤–∏—Ç—å FOREIGN KEY        | ALTER TABLE orders ADD CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(id);             |
| ‚ûï –î–æ–±–∞–≤–∏—Ç—å UNIQUE             | ALTER TABLE users ADD CONSTRAINT unique_email UNIQUE (email);                                     |
| ‚ûï –î–æ–±–∞–≤–∏—Ç—å CHECK              | ALTER TABLE users ADD CONSTRAINT check_age CHECK (age >= 18);                                     |
| ‚ùå –£–¥–∞–ª–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ         | ALTER TABLE users DROP CONSTRAINT check_age;                                                      |
| ‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ  | ALTER TABLE users RENAME CONSTRAINT old_name TO new_name;                                         |
| ‚ûï –î–æ–±–∞–≤–∏—Ç—å INHERITS           | ALTER TABLE logs INHERIT base_logs;                                                               |
| ‚ùå –£–¥–∞–ª–∏—Ç—å INHERITS            | ALTER TABLE logs NO INHERIT base_logs;                                                            |
| ‚ûï –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏—é       | ALTER TABLE orders ATTACH PARTITION orders_2025 FOR VALUES FROM ('2025-01-01') TO ('2026-01-01'); |
| ‚ùå –û—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏—é        | ALTER TABLE orders DETACH PARTITION orders_2025;                                                  |

### –†–æ–ª–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

–ê—Ç—Ä–∏–±—É—Ç—ã —Ä–æ–ª–µ–π

| –ê—Ç—Ä–∏–±—É—Ç     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                     |
|-------------|--------------------------------|
| LOGIN       | –ú–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è             |
| SUPERUSER   | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –æ–±—ä–µ–∫—Ç–∞–º |
| CREATEDB    | –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∞–∑—ã           |
| CREATEROLE  | –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–æ–ª–∏           |
| INHERIT     | –ù–∞—Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –æ—Ç –≥—Ä—É–ø–ø  |
| REPLICATION | –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é  |
| BYPASSRLS   | –û–±—Ö–æ–¥–∏—Ç Row-Level Security     |

````sql
CREATE ROLE admin LOGIN SUPERUSER CREATEDB CREATEROLE;
````

```sql
CREATE ROLE alex LOGIN PASSWORD 'secure';
GRANT
CONNECT
ON DATABASE mydb TO alex;
```

### –•—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ (PL/pgSQL)

* –ü–æ–∑–≤–æ–ª—è—é—Ç –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É:

````sql
CREATE FUNCTION get_user_orders(uid INT)
    RETURNS TABLE
            (
                .
                .
                .
            ) AS $$
BEGIN
RETURN QUERY SELECT * FROM orders WHERE user_id = uid;
END;
$$
LANGUAGE plpgsql;
````

* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç IF, LOOP, EXCEPTION, RETURN QUERY PL/pgSQL Tutorial

| –ö–æ–º–∞–Ω–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ      |
|---------|-----------------|
| GRANT   | –ù–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–∞–≤–∞ |
| REVOKE  | –û—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞  |

````sql
GRANT SELECT, INSERT ON users TO alex;
REVOKE DELETE ON users FROM alex;
````

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

````sql
BEGIN;
UPDATE users
SET name = '–ê–ª–µ–∫—Å–µ–π'
WHERE id = 1;
COMMIT;
````

–ò–ª–∏ —Å –æ—Ç–∫–∞—Ç–æ–º:

````sql
BEGIN;
DELETE
FROM orders
WHERE id = 42;
ROLLBACK;
````

–£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏

| –£—Ä–æ–≤–µ–Ω—å          | –ü–æ–≤–µ–¥–µ–Ω–∏–µ                                                      |
|------------------|----------------------------------------------------------------|
| READ UNCOMMITTED | –í–∏–¥–Ω—ã –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ PostgreSQL) |
| READ COMMITTED   | –í–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)             |
| REPEATABLE READ  | –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚Äî —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ                                |
| SERIALIZABLE     | –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è, –∫–∞–∫ –±—É–¥—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ –æ—á–µ—Ä–µ–¥–∏   |

 ````sql
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
````

### –ò–Ω–¥–µ–∫—Å—ã –≤ PostgreSQL

| –¢–∏–ø                              | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                           | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ                                                           |
|----------------------------------|------------------------------------------------------|----------------------------------------------------------------------|
| B-TREE                           | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ä–∞–≤–µ–Ω—Å—Ç–≤—É –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—É | WHERE age > 30, ORDER BY name                                        |
| HASH                             | –ü–æ —Ä–∞–≤–µ–Ω—Å—Ç–≤—É. –ë—ã—Å—Ç—Ä–µ–µ B-Tree, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω           | WHERE code = 'ABC123'                                                |
| GIN (Generalized Inverted Index) | –î–ª—è –º–∞—Å—Å–∏–≤–æ–≤, JSONB, –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞          | WHERE tags @> ['postgres'], WHERE jsonb_column @> '{"key": "value"}' |
| GiST (Generalized Search Tree)   | –î–ª—è –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö, –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, fuzzy-–ø–æ–∏—Å–∫–∞              | WHERE tsrange @> now(), PostGIS                                      |
| BRIN (Block Range Index)         | –î–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü —Å —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏          | WHERE created_at > now() - interval '1 day' –Ω–∞ –º–∏–ª–ª–∏–æ–Ω–∞—Ö —Å—Ç—Ä–æ–∫       |

### –ö–∞–∫ –≤—ã–±–∏—Ä–∞—Ç—å –∏–Ω–¥–µ–∫—Å

| –°—Ü–µ–Ω–∞—Ä–∏–π                           | –¢–∏–ø –∏–Ω–¥–µ–∫—Å–∞               |
|------------------------------------|---------------------------|
| –†–∞–≤–µ–Ω—Å—Ç–≤–æ, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –¥–∏–∞–ø–∞–∑–æ–Ω—ã   | B-TREE                    |
| JSONB, –º–∞—Å—Å–∏–≤—ã, –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç         | GIN                       |
| –î–∏–∞–ø–∞–∑–æ–Ω—ã, –≥–µ–æ, fuzzy              | GiST                      |
| –û–≥—Ä–æ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | BRIN                      |
| –¢–æ—á–Ω–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ, –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏   | HASH (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |

–£–∫–∞–∑–∞–Ω–∏–µ —Ç–∏–ø–∞ –∏–Ω–¥–µ–∫—Å–∞

````sql
CREATE INDEX index_name ON table_name USING btree (column);
CREATE INDEX index_name ON table_name USING gin (jsonb_column);
CREATE INDEX index_name ON table_name USING gist (geom_column);
CREATE INDEX index_name ON table_name USING brin (created_at);
````

````sql
SELECT indexname, indexdef
FROM pg_indexes
WHERE schemaname = 'public';
````

````sql
DROP INDEX index_name;
````

#### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤

üîç EXPLAIN

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ PostgreSQL –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å:

````sql
EXPLAIN
SELECT *
FROM users
WHERE age > 30;
````

üî¨ EXPLAIN ANALYZE

–í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã:

````sql
EXPLAIN
ANALYZE
SELECT *
FROM users
WHERE age > 30;
````

–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:

* Seq Scan ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä (–º–µ–¥–ª–µ–Ω–Ω–æ)
* Index Scan ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ (–±—ã—Å—Ç—Ä–æ)
* Rows, Cost, Buffers ‚Äî –æ—Ü–µ–Ω–∫–∞ –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã

### –¢—Ä–∏–≥–≥–µ—Ä –∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

üì¶ –¢–∞–±–ª–∏—Ü–∞ –∞—É–¥–∏—Ç–∞

````sql
CREATE TABLE audit_log
(
    id         SERIAL PRIMARY KEY,
    table_name TEXT,
    operation  TEXT,
    changed_at TIMESTAMPTZ DEFAULT now(),
    user_name  TEXT,
    row_data   JSONB
);
````

üß† –§—É–Ω–∫—Ü–∏—è –∞—É–¥–∏—Ç–∞

```sql
CREATE
OR REPLACE FUNCTION audit_changes() RETURNS TRIGGER AS $$
BEGIN
INSERT INTO audit_log (table_name, operation, user_name, row_data)
VALUES (TG_TABLE_NAME,
        TG_OP,
        current_user,
        CASE
            WHEN TG_OP = 'DELETE' THEN to_jsonb(OLD)
            ELSE to_jsonb(NEW)
            END);
RETURN NULL;
END;
$$
LANGUAGE plpgsql;
```

üîó –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ —Ç–∞–±–ª–∏—Ü–µ

````sql
CREATE TRIGGER trg_audit_users
    AFTER INSERT OR
UPDATE OR
DELETE
ON users
    FOR EACH ROW EXECUTE FUNCTION audit_changes();
````

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (VIEW)

````sql
CREATE VIEW active_users AS
SELECT id, name, email
FROM users
WHERE is_active = TRUE;
````
üí° –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è ‚Äî —ç—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –Ω–µ —Ö—Ä–∞–Ω—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π MATERIALIZED VIEW.

#### üß† –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (PL/pgSQL)

````sql
CREATE OR REPLACE FUNCTION get_user_orders(uid INT)
RETURNS TABLE(order_id INT, total NUMERIC) AS $$
BEGIN
    RETURN QUERY
    SELECT id, total FROM orders WHERE user_id = uid;
END;
$$ LANGUAGE plpgsql;
````
üí° –§—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å TABLE, SETOF, VOID, TEXT, JSONB –∏ —Ç.–¥.

#### üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

````sql
CREATE PROCEDURE archive_old_orders()
LANGUAGE plpgsql
AS $$
BEGIN
    DELETE FROM orders WHERE created_at < now() - interval '1 year';
END;
$$;
````
üí° –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ CALL, –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è:
````sql
CALL archive_old_orders();
````
### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ CTE

–°–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:

````sql
CREATE
TEMP TABLE temp_users AS
SELECT *
FROM users
WHERE is_active = TRUE;
````

* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
* –£–¥–æ–±–Ω—ã –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
* –ù–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

#### Materialized Views

–ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è ‚Äî —ç—Ç–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é:
````sql
CREATE MATERIALIZED VIEW mv_top_users AS
SELECT user_id, COUNT(*) AS orders FROM orders GROUP BY user_id;
````
* –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: REFRESH MATERIALIZED VIEW mv_top_users;
* –ë–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: REFRESH MATERIALIZED VIEW CONCURRENTLY mv_top_users;
* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ü–∏–π –∏ JOIN'–æ–≤
üßµ CTE (Common Table Expressions)

–ü–æ–∑–≤–æ–ª—è—é—Ç –ø–∏—Å–∞—Ç—å –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

````sql
WITH active_users AS (SELECT *
                      FROM users
                      WHERE is_active = TRUE)
SELECT name
FROM active_users
WHERE created_at > now() - interval '1 month';
````

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ PostgreSQL

| –ü—Ä–æ—Ü–µ—Å—Å               | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                      |
|-----------------------|-------------------------------------------------|
| postmaster / postgres | –ì–ª–∞–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ            |
| bgwriter              | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç dirty pages –∏–∑ –±—É—Ñ–µ—Ä–∞ –Ω–∞ –¥–∏—Å–∫        |
| checkpointer          | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã (—Ç–æ—á–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è) |
| wal writer            | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç WAL (–∂—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)              |
| autovacuum            | –û—á–∏—â–∞–µ—Ç –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã                  |
| archiver              | –ê—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç WAL-—Ñ–∞–π–ª—ã (–¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)           |
| stats collector       | –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞                |
| client backend        | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤                |

üìÅ –ö–∞—Ç–∞–ª–æ–≥–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

* data/ ‚Äî –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥ –¥–∞–Ω–Ω—ã—Ö
* base/ ‚Äî –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü
* pg_wal/ ‚Äî –∂—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (Write-Ahead Logging)
* pg_stat/ ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
* pg_tblspc/ ‚Äî —Ç–∞–±–ª–∏—Ü—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞—Ö
* postgresql.conf, pg_hba.conf, pg_ident.conf ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

üß† –ü–∞–º—è—Ç—å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç            | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                  |
|----------------------|-----------------------------|
| shared_buffers       | –û—Å–Ω–æ–≤–Ω–æ–π –±—É—Ñ–µ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö   |
| work_mem             | –ü–∞–º—è—Ç—å –Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Ö–µ—à–∏ |
| maintenance_work_mem | –î–ª—è VACUUM, CREATE INDEX    |
| effective_cache_size | –û—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–µ—à–∞ –û–°   |
| temp_buffers         | –ë—É—Ñ–µ—Ä—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü |

‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è postgresql.conf

–ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ $PGDATA/postgresql.conf. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è      | –ü—Ä–∏–º–µ—Ä—ã                                        |
|----------------|------------------------------------------------|
| üîå –°–µ—Ç–µ–≤—ã–µ     | listen_addresses, port                         |
| üß† –ü–∞–º—è—Ç—å      | shared_buffers, work_mem, effective_cache_size |
| üîÑ WAL         | wal_level, max_wal_size, checkpoint_timeout    |
| üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | log_min_duration_statement, log_line_prefix    |
| üßº –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ | autovacuum, autovacuum_work_mem                |
| üß™ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ | random_page_cost, cpu_tuple_cost               |

### –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: pg_dump

* –°–æ–∑–¥–∞—ë—Ç SQL-–¥–∞–º–ø –∏–ª–∏ –∞—Ä—Ö–∏–≤, –ø—Ä–∏–≥–æ–¥–Ω—ã–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –¥–∞–Ω–Ω—ã—Ö
* –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π, —á–∞—Å—Ç–∏—á–Ω—ã—Ö –∫–æ–ø–∏–π, CI/CD
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã: plain, custom, directory, tar

üì¶ –ü—Ä–∏–º–µ—Ä—ã
````bash
pg_dump -U alex -d mydb > backup.sql          # plain SQL
pg_dump -Fc -U alex -d mydb -f backup.dump    # custom format
pg_dump -Fd -U alex -d mydb -f ./dump_dir     # directory format
 ````
üí° –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
````bash
psql -U alex -d newdb < backup.sql
pg_restore -U alex -d newdb backup.dump
````

### üß¨ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ master‚Äìreplica –∫–ª–∞—Å—Ç–µ—Ä–∞ PostgreSQL

üîÅ –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

| –¢–∏–ø        | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                                |
|------------|----------------------------------------------------------------------------|
| –§–∏–∑–∏—á–µ—Å–∫–∞—è | –ü–æ–±–∞–π—Ç–æ–≤–∞—è –∫–æ–ø–∏—è —á–µ—Ä–µ–∑ WAL. –ù–∞–¥—ë–∂–Ω–æ, –±—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ–ª—å–∑—è —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã |
| –õ–æ–≥–∏—á–µ—Å–∫–∞—è | –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü. –ì–∏–±–∫–æ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –∏ CDC            |

‚öôÔ∏è –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (–ø—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)

1. –ù–∞ –º–∞—Å—Ç–µ—Ä–µ:

* –í postgresql.conf:

```conf
wal_level = replica
max_wal_senders = 5
wal_keep_size = 64MB
```

* –í pg_hba.conf:

````
host replication replicator 192.168.0.2/32 md5
````

* –°–æ–∑–¥–∞–π —Ä–æ–ª—å:

````sql
CREATE ROLE replicator WITH REPLICATION LOGIN PASSWORD 'secret';
````

2. –ù–∞ —Ä–µ–ø–ª–∏–∫–µ:

* –ò—Å–ø–æ–ª—å–∑—É–π pg_basebackup:

````bash
pg_basebackup -h master_ip -D /var/lib/postgresql/14/main -U replicator -P --wal-method=stream
````

* –°–æ–∑–¥–∞–π standby.signal –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –¥–∞–Ω–Ω—ã—Ö
* –í postgresql.conf:

````conf
primary_conninfo = 'host=master_ip user=replicator password=secret'
````

3. –ó–∞–ø—É—Å—Ç–∏ —Ä–µ–ø–ª–∏–∫—É ‚Äî –æ–Ω–∞ –±—É–¥–µ—Ç —á–∏—Ç–∞—Ç—å WAL —Å –º–∞—Å—Ç–µ—Ä–∞
   üí° –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–æ–±–∞–≤—å:

````conf
synchronous_standby_names = 'replica1'
````

#### üßπ –û—á–∏—Å—Ç–∫–∞: VACUUM, ANALYZE, Autovacuum

üîÑ VACUUM
* –£–¥–∞–ª—è–µ—Ç "–º—ë—Ä—Ç–≤—ã–µ" –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫, –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–æ—Å–ª–µ UPDATE/DELETE (MVCC)
* –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º–µ—Å—Ç–æ, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–¥—É–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
* –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —á—Ç–µ–Ω–∏–µ, –Ω–æ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –∑–∞–ø–∏—Å—å
````sql
VACUUM users;
VACUUM FULL users; -- –±–ª–æ–∫–∏—Ä—É—é—â–∏–π, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É
````
üìä ANALYZE
* –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
* –í–ª–∏—è–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä Seq Scan vs Index Scan
````sql
ANALYZE users;
````
ü§ñ Autovacuum
* –§–æ–Ω–æ–≤—ã–π –¥–µ–º–æ–Ω, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç VACUUM –∏ ANALYZE
* –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑:
````conf
autovacuum = on
autovacuum_vacuum_threshold = 50
autovacuum_vacuum_scale_factor = 0.2
````

#### –ë—É—Ñ–µ—Ä–Ω—ã–π –∫–µ—à: shared_buffers

* –û—Å–Ω–æ–≤–Ω–æ–π –∫–µ—à PostgreSQL ‚Äî —Ö—Ä–∞–Ω–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤
* –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 25‚Äì40% –æ—Ç RAM
* –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å–Ω–∞—á–∞–ª–∞ —á–∏—Ç–∞—é—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞, –∞ –Ω–µ —Å –¥–∏—Å–∫–∞
````conf
shared_buffers = 4GB
````
üì¶ –î—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä             | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                      |
|----------------------|---------------------------------|
| work_mem             | –ü–∞–º—è—Ç—å –Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, —Ö–µ—à–∏, CTE |
| effective_cache_size | –û—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–µ—à–∞ –û–°       |
| maintenance_work_mem | –î–ª—è VACUUM, CREATE INDEX        |

üí° –ò—Å–ø–æ–ª—å–∑—É–π pg_buffercache –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–µ—à–∞

üìú –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: WAL (Write-Ahead Logging)
* –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ –ø–∏—à—É—Ç—Å—è –≤ WAL, –∑–∞—Ç–µ–º ‚Äî –≤ —Ç–∞–±–ª–∏—Ü—ã
* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç Atomicity –∏ Durability (ACID)
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
* –†–µ–ø–ª–∏–∫–∞—Ü–∏–∏
* * –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ—è
* * PITR (Point-In-Time Recovery)
üìÅ –ö–∞—Ç–∞–ª–æ–≥ WAL
* –ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ pg_wal/
* WAL-—Ñ–∞–π–ª—ã: 00000001000000000000000A –∏ —Ç.–ø.
üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
````conf
wal_level = replica
max_wal_size = 1GB
checkpoint_timeout = 5min
````
üí° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: pg_stat_bgwriter, pg_current_wal_lsn() 

üí° –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, introspection –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

üí° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: pg_stat_user_tables, pg_stat_all_tables

#### –ß—Ç–æ —Ç–∞–∫–æ–µ Row-Level Security (RLS)

RLS ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:
* –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–æ–∫–∞–º —Ç–∞–±–ª–∏—Ü—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ä–æ–ª–∏ –∏–ª–∏ —É—Å–ª–æ–≤–∏–π
* –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ SELECT, UPDATE, DELETE, INSERT
* –†–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –æ–±—ã—á–Ω—ã–º –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º (GRANT)

üîß –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å RLS
````sql
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;
````
üí° –î–ª—è –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç—ã:
````sql
ALTER TABLE orders FORCE ROW LEVEL SECURITY;
````
–≠—Ç–æ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –æ–±—Ö–æ–¥ RLS –¥–∞–∂–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤—Ü–∞–º–∏ –±–µ–∑ BYPASSRLS

üìú –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏
````sql
CREATE POLICY user_orders_policy
ON orders
FOR SELECT
USING (user_id = current_user::INT);
````
* USING ‚Äî —É—Å–ª–æ–≤–∏–µ –¥–ª—è SELECT, UPDATE, DELETE
* WITH CHECK ‚Äî —É—Å–ª–æ–≤–∏–µ –¥–ª—è INSERT, UPDATE
* 
üîÑ –ü—Ä–∏–º–µ—Ä —Å WITH CHECK
````sql
CREATE POLICY insert_check
ON orders
FOR INSERT
WITH CHECK (user_id = current_user::INT);
````
üß† –ü—Ä–∏–º–µ—Ä—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

| –°—Ü–µ–Ω–∞—Ä–∏–π                         | –ü–æ–ª–∏—Ç–∏–∫–∞                                          |
|----------------------------------|---------------------------------------------------|
| –ú—É–ª—å—Ç–∏–∞—Ä–µ–Ω–¥–Ω–æ—Å—Ç—å (multi-tenancy) | tenant_id = current_setting('app.tenant_id')::INT |
| –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å—Ç—Ä–æ–∫–∏               | owner_id = current_user::INT                      |
| –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ                  | is_active = TRUE                                  |
| –¢–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è           | EXTRACT(HOUR FROM now()) BETWEEN 9 AND 18         |

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫ (–æ–±–∑–æ—Ä)
1.	–û—Ç–∫—Ä—ã—Ç—ã–π —Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø / –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞—è —Å–µ—Ç–µ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è ‚Äî –∫–æ–≥–¥–∞ Postgres —Å–ª—É—à–∞–µ—Ç –Ω–∞ 0.0.0.0 –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. PostgreSQL
2.	–°–ª–∞–±–∞—è –∏–ª–∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ trust, peer/ident –≤ –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ–π —Å—Ä–µ–¥–µ, MD5 –±–µ–∑ —Å–∏–ª—å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π). mydbops.com+1
3.	–û—à–∏–±–∫–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ‚Üí SQL injection / unsafe queries ‚Äî –ø–æ–∑–≤–æ–ª—è—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
4.	–ß—Ä–µ–∑–º–µ—Ä–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ / –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–æ–ª–∏ (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ superuser, –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ GRANT). Percona
5.	–£—è–∑–≤–∏–º–æ—Å—Ç–∏ —è–¥—Ä–∞/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π / CVE ‚Äî –ø–ª–∞–≥–∏–Ω—ã, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Å–µ—Ä–≤–µ—Ä –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (CVE). app.opencve.io+1
6.	–ö—Ä–∞–∂–∞ –∏–ª–∏ —É—Ç–µ—á–∫–∞ –±–µ–∫–∞–ø–æ–≤ / WAL / –∫–æ–Ω—Ñ–∏–≥–æ–≤ ‚Äî –Ω–µ–∑–∞—â–∏—â—ë–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –¥–∞—é—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º. Bytebase
7.	Man-in-the-Middle / –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Äî –ø–µ—Ä–µ—Ö–≤–∞—Ç —Ç—Ä–∞—Ñ–∏–∫–∞, —Å—ä—ë–º —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å–µ—Å—Å–∏–π. EDB
8.	OS-—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∞—Ç–∞–∫–∏ / –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è ‚Äî –µ—Å–ª–∏ —Ö–æ—Å—Ç/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å PostgreSQL —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω, –ë–î –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π.
9.	–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pg_hba.conf ‚Äî —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ host all all 0.0.0.0/0 md5 –∏–ª–∏ trust. PostgreSQL

### –ü—Ä–æ—Ç–∏–≤–æ–¥–µ–π—Å—Ç–≤–∏–µ ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)

#### –°–µ—Ç—å –∏ –¥–æ—Å—Ç—É–ø

* –û–≥—Ä–∞–Ω–∏—á—å —Å–ª—É—à–∞—é—â–∏–µ –∞–¥—Ä–µ—Å–∞: listen_addresses ‚Äî —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä 127.0.0.1 –∏–ª–∏ IP/—Å–µ—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è).
```–ü—Ä–∏–º–µ—Ä: 
listen_addresses = '127.0.0.1,10.0.2.5'
```
* –ò—Å–ø–æ–ª—å–∑—É–π –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä / Security Groups / VPC: —Ä–∞–∑—Ä–µ—à–∞—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å IP/–ø–æ–¥—Å–µ—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ bastion-—Ö–æ—Å—Ç–æ–≤.
* Bastion / VPN / SSH tunnel: –¥–ª—è –∞–¥–º–∏–Ω-–¥–æ—Å—Ç—É–ø–∞ ‚Äî –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π 5432 –≤ –ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SCRAM-SHA-256 (–≤–∫–ª—é—á–∞—è password_encryption = scram-sha-256) –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ MD5/trust.
* –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π –ø—Ä–∞–≤–∞: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –Ω–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏; –¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ö–µ–º—ã/—Ç–∞–±–ª–∏—Ü—ã/—Ä–æ–ª–∏.
* –†–∞–∑–¥–µ–ª—è–π —Ä–æ–ª–∏: —Ä–æ–ª—å –¥–ª—è —á—Ç–µ–Ω–∏—è, —Ä–æ–ª—å –¥–ª—è –∑–∞–ø–∏—Å–∏, —Ä–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.
* –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ + —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Vault (HashiCorp Vault / cloud secret managers).
````
pg_hba.conf ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞
````
* –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ IP, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü—Ä–∏–º–µ—Ä (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —à–∞–±–ª–æ–Ω):
* *  local connections from the same host
* * #local   all             all                                   peer
* * #internal app servers only (require scram)
* * host    all             app_user      10.0.1.0/24           scram-sha-256
* * #admin access via bastion
* * host    all             admin_user    10.0.2.10/32          scram-sha-256
* –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ host all all 0.0.0.0/0 trust. PostgreSQL+1

#### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –¥–∞–Ω–Ω—ã—Ö

* SSL/TLS –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π; –∑–∞—Å—Ç–∞–≤–ª—è–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. (ssl = on, pg_hba hostssl –ø—Ä–∞–≤–∏–ª–∞). EDB
* –®–∏—Ñ—Ä—É–π—Ç–µ –±–µ–∫–∞–ø—ã –∏ WAL-–∞—Ä—Ö–∏–≤—ã (–Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Äî S3 —Å SSE, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∏—Å–∫–∏).
* At-rest encryption: –ª–∏–±–æ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É/volume encryption (LUKS, cloud CMEK), –ª–∏–±–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –°–£–ë–î —Å pgcrypto –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π.

#### –•–∞—Ä–¥—ç–Ω–Ω–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

* –ó–∞–ø—É—Å–∫–∞–π postgres –Ω–µ –æ—Ç root; –æ–≥—Ä–∞–Ω–∏—á—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –û–°.
* –û–≥—Ä–∞–Ω–∏—á—å —É—Å—Ç–∞–Ω–æ–≤–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π ‚Äî —Ä–∞–∑—Ä–µ—à–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è; –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π shared_preload_libraries. Percona
* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: –Ω–µ –∑–∞–ø—É—Å–∫–∞–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä postgres —Å –ª–∏—à–Ω–∏–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏ (no --privileged); –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–∞–∑—ã –æ–±—Ä–∞–∑–æ–≤; secure runtime.

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ CVE

* –ü–∞—Ç—á—å PostgreSQL –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ; –ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è –Ω–∞ —Å–ø–∏—Å–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–π CVE. PostgreSQL+1
* –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö CVE ‚Äî –ø—Ä–∏–º–µ–Ω—è–π –ø–∞—Ç—á–∏ –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É change-management –∏ —Ç–µ—Å—Ç–∏—Ä—É–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö.

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç SQLi

* –ò—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã / –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (ORM —Å prepared statements).
* –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è + DB constraints (CHECK, foreign keys).
* WAF / Application Security –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

#### –ê—É–¥–∏—Ç, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

* –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –æ—à–∏–±–æ–∫: –≤–∫–ª—é—á–∏ log_connections, log_disconnections, log_statement (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –¥–ª—è prod) –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–π –ª–æ–≥–∏.
* pg_audit: —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: pg_stat_activity, pg_stat_statements, Prometheus exporters, –∞–ª–µ—Ä—Ç—ã –Ω–∞ –≤–Ω–µ–∑–∞–ø–Ω—ã–µ spike‚Äô—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π/–ø—Ä–æ—Ü–µ—Å—Å–æ–≤. Percona
* IDS/IPS & SIEM: –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ª–æ–≥–æ–≤, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π (–≤–Ω–µ–∑–∞–ø–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö, mass DELETE).

#### –ë—ç–∫–∞–ø—ã –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

* –®–∏—Ñ—Ä—É–π –∏ —Ç–µ—Å—Ç–∏—Ä—É–π –±–µ–∫–∞–ø—ã; —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–æ–¥–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±–µ–∫–∞–ø–æ–≤ (DR drills).
* –û–≥—Ä–∞–Ω–∏—á—å –¥–æ—Å—Ç—É–ø –∫ –±–µ–∫–∞–ø-—Ö—Ä–∞–Ω–∏–ª–∏—â—É; –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –∏ –∫–ª—é—á–∏ –¥–ª—è –±—ç–∫–æ–≤.

#### Runtime –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏ –∫–≤–æ—Ç—ã

* connection pooling (pgBouncer) ‚Äî —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∏—Å–∫ DoS –æ—Ç –±–æ–ª—å—à–æ–≥–æ —á–∏—Å–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ OS / cgroups ‚Äî –ø–æ–º–Ω–∏—Ç—å –ø—Ä–æ —Ä–µ—Å—É—Ä—Å–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é, —á—Ç–æ–±—ã prevent resource exhaustion.

#### –ó–∞—â–∏—Ç–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏ FDW

* –û–≥—Ä–∞–Ω–∏—á—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ FDW –∏ –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π: –æ–Ω–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø–ª–æ—Å–∫–æ—Å—Ç—å –∞—Ç–∞–∫–∏. Percona

#### –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç

1.	–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏: –Ω–µ–æ–±—ã—á–Ω—ã–µ IP-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, spike export‚Äô–æ–≤, –Ω–æ–≤—ã–µ superuser —Ä–æ–ª—ñ, –Ω–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±—ç–∫–∞–ø—ã, –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ pg_hba.conf, –Ω–æ–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
2.	–ü–µ—Ä–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å (bastion/—Ñ–∞–π—Ä–≤–æ–ª) –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫, —Å–¥–µ–ª–∞—Ç—å —Ñ–æ—Ä–µ–Ω–∑–∏–∫-—Å–Ω–∏–º–∫–∏ (–ª–æ–≥, WAL, config), —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–µ–∫–∞–ø—ã, –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –±–µ–∑ –Ω—É–∂–¥—ã.
3.	–ê–Ω–∞–ª–∏–∑: –ª–æ–≥/–∞—É–¥–∏—Ç, –ø–æ–∏—Å–∫ SQL-–∏–Ω—ä–µ–∫—Ü–∏–π, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏.
4.	–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: –æ—Ç–∫–∞—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –±–µ–∫–∞–ø –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, —Å–º–µ–Ω–∞ –≤—Å–µ—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π.
5.	–†–∞–∑–±–æ—Ä –ø–æ–ª—ë—Ç–æ–≤ (post-mortem): —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–µ–Ω–Ω–æ–π –ø—Ä–∏—á–∏–Ω—ã –∏ —É—Å–∏–ª–µ–Ω–∏–µ –º–µ—Ä (patch, –∫–æ–Ω—Ñ–∏–≥, CVE mitigation).

### –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç (To-Do ‚Äî 30/60/90 –º–∏–Ω—É—Ç)

#### –ó–∞ 30 –º–∏–Ω—É—Ç

* –û—Ç–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ 5432 (Firewall / SG).
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å listen_addresses –∏ pg_hba.conf –Ω–∞ trust/0.0.0.0/0. 
* –í–∫–ª—é—á–∏—Ç—å SSL (ssl = on) –∏ —Ç—Ä–µ–±–æ–≤–∞—Ç—å hostssl –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π. EDB

#### –ó–∞ 24 —á–∞—Å–∞

* –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ scram-sha-256; –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –ø–∞—Ä–æ–ª–µ–π. 
* –í–∫–ª—é—á–∏—Ç—å –±–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (log_connections, log_disconnections, log_statement for suspicious users).
* –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ (Prometheus) –∏ –±–∞–∑–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã (—Å–ø–∞–π–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏).

#### –ó–∞ –Ω–µ–¥–µ–ª—é

* –ê—É–¥–∏—Ç —Ä–æ–ª–µ–π/–ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (—É–¥–∞–ª–∏—Ç—å superuser —É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π).
* –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–µ–∫–∞–ø—ã –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ. 
* –û–±–Ω–æ–≤–∏—Ç—å PostgreSQL –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–∞—Ç—á–µ–π (–µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑ —Ä–∏—Å–∫–æ–≤).
–ó–∞–¥–∞—á–∞ ‚Äî –ø–æ–Ω—è—Ç—å, –≥–¥–µ –ø—Ä–µ–¥–µ–ª –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–∞–∫ –≤–µ–¥—ë—Ç —Å–µ–±—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏:
‚Ä¢	–°–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É (TPS/QPS) –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç?
‚Ä¢	–ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ (CPU, RAM, –¥–∏—Å–∫, I/O, —Å–µ—Ç—å, lock)?
‚Ä¢	–ö–∞–∫ –±—ã—Å—Ç—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏?
‚Ä¢	–ì–¥–µ —Ç–æ—á–∫–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (latency, deadlocks)?

### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å pgbench

üì¶ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã
````bash
pgbench -i -s 10 -U postgres postgres
````
-s 10 ‚Äî –º–∞—Å—à—Ç–∞–± (—á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º —Ç—è–∂–µ–ª–µ–µ)

üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
````bash
pgbench -c 10 -j 4 -T 60 -U postgres postgres
````

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ          |
|----------|-------------------|
| -c       | –ö–æ–ª-–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤   |
| -j       | –ö–æ–ª-–≤–æ –ø–æ—Ç–æ–∫–æ–≤    |
| -T       | –í—Ä–µ–º—è —Ç–µ—Å—Ç–∞ (—Å–µ–∫) |

üí° –ò—Å–ø–æ–ª—å–∑—É–π --log –∏ --progress –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
````
tps = 1640.918203 (–±–µ–∑ —É—á–µ—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
latency average = 12.34 ms
stddev = 3.22 ms
````

### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (—á–µ—Ä–µ–∑ Django / FastAPI) postgres 

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

PostgreSQL: –≤–∫–ª—é—á–∏ pg_stat_statements –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

Django: –æ—Ç–∫–ª—é—á–∏ DEBUG, –≤–∫–ª—é—á–∏ CONN_MAX_AGE, –Ω–∞—Å—Ç—Ä–æ–π gunicorn –∏–ª–∏ uvicorn

FastAPI: –∏—Å–ø–æ–ª—å–∑—É–π asyncpg –∏–ª–∏ SQLAlchemy —Å async —Ä–µ–∂–∏–º–æ–º

Docker: –∏–∑–æ–ª–∏—Ä—É–π PostgreSQL –∏ API, —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã

–ü—Ä–∏–º–µ—Ä Locust-—Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è FastAPI
````python
from locust import HttpUser, task, between

class APITestUser(HttpUser):
    wait_time = between(1, 3)

    @task
    def get_items(self):
        self.client.get("/items")

    @task
    def create_item(self):
        self.client.post("/items", json={"name": "test", "price": 10})
````
–ó–∞–ø—É—Å–∫:

````bash
locust -f locustfile.py --host=http://localhost:8000
````

#### –ú–µ—Ç—Ä–∏–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç —Å–º–æ—Ç—Ä–µ—Ç—å

TPS (transactions per second) ‚Äî –∫–∞–∫ –≤ pgbench

Latency ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –∏ 95-–π/99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏

–û—à–∏–±–∫–∏ ‚Äî 4xx, 5xx

CPU / RAM / IOPS ‚Äî —á–µ—Ä–µ–∑ docker stats, htop, pg_stat_activity

–ü—Ä–∏–º–µ—Ä –Ω–∞ k6:
````javascript
import http from "k6/http";
import { check, sleep } from "k6";

export let options = {
  vus: 50,          // 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  duration: "1m",   // 1 –º–∏–Ω—É—Ç–∞
};

export default function () {
  let res = http.get("http://localhost:8000/api/items");
  check(res, { "status is 200": (r) => r.status === 200 });
  sleep(1);
}
````
–ó–∞–ø—É—Å–∫:
```
k6 run test.js
```
SQL-–∑–∞–ø—Ä–æ—Å—ã ‚Äî EXPLAIN ANALYZE, pg_stat_statements 

#### –í–∏–¥—ã –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –¢–∏–ø            | –¶–µ–ª—å                                                                         |
|----------------|------------------------------------------------------------------------------|
| Load Test      | –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ–≤—ã—à–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É –¥–æ —Ä–∞–±–æ—á–µ–≥–æ —É—Ä–æ–≤–Ω—è (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è)    |
| Stress Test    | –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞ –ø—Ä–µ–¥–µ–ª–æ–º –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (—Å—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –æ—à–∏–±–∫–∏) |
| Spike Test     | –†–µ–∑–∫–∏–µ –≤—Å–ø–ª–µ—Å–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (–∏–º–∏—Ç–∞—Ü–∏—è ‚Äú—á–µ—Ä–Ω–æ–π –ø—è—Ç–Ω–∏—Ü—ã‚Äù)                         |
| Endurance Test | –î–æ–ª–≥–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ–¥ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π (—Ç–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏, —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏)    |
| Benchmarking   | –ß–∏—Å—Ç–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (TPS, latency, CPU)           |

#### –ö–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –°–∏–º–ø—Ç–æ–º              | –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞       | –†–µ—à–µ–Ω–∏–µ                                        |
|----------------------|-------------------------|------------------------------------------------|
| TPS –Ω–∏–∑–∫–∏–π           | –º–∞–ª–æ CPU / —Å–ª–∞–±—ã–π –¥–∏—Å–∫  | —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã, tune shared_buffers         |
| Latency —Å–∫–∞—á–µ—Ç       | contention / locks      | –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å pg_locks, –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã     |
| Load avg —Ä–∞—Å—Ç—ë—Ç      | I/O –∏–ª–∏ WAL bottleneck  | —É–≤–µ–ª–∏—á–∏—Ç—å wal_buffers, SSD                     |
| –†–æ—Å—Ç deadlock‚Äô–æ–≤     | –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏                   |
| Cache hit rate < 90% | –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏       | —É–≤–µ–ª–∏—á–∏—Ç—å shared_buffers, effective_cache_size |

### –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç (PostgreSQL Load Test Checklist)

* –ù–∞—Å—Ç—Ä–æ–µ–Ω pg_stat_statements
* –ü—Ä–æ–≤–µ–¥—ë–Ω pgbench –Ω–∞ —Ä–∞–∑–Ω—ã—Ö scale-—Ñ–∞–∫—Ç–æ—Ä–∞—Ö
* –°–æ–±—Ä–∞–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ CPU, RAM, IO, TPS, latency
* –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ pgBadger
* –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ (stress test)
* –ù–∞—Å—Ç—Ä–æ–µ–Ω Prometheus / Grafana –¥–∞—à–±–æ—Ä–¥





### –õ—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:

* ‚úÖ –í—Å–µ–≥–¥–∞ –∑–∞–¥–∞–≤–∞–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ UUID, SERIAL –∏–ª–∏ —Å–æ—Å—Ç–∞–≤–Ω–æ–π
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –¥–ª—è —è–≤–Ω—ã—Ö —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏
* ‚úÖ –î–æ–±–∞–≤–ª—è–π –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è JOIN'–æ–≤
* ‚úÖ –í–∫–ª—é—á–∞–π ON DELETE CASCADE –∏–ª–∏ ON DELETE SET NULL, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π SERIAL –∏–ª–∏ UUID –¥–ª—è PRIMARY KEY
* ‚úÖ –ü—Ä–∏–º–µ–Ω—è–π JSONB –¥–ª—è –≥–∏–±–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, –Ω–æ –Ω–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π ‚Äî –ª—É—á—à–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å
* ‚úÖ –î–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ‚Äî NUMERIC(12,2) –≤–º–µ—Å—Ç–æ FLOAT
* ‚úÖ –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π NOT NULL, –µ—Å–ª–∏ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
* ‚úÖ –î–æ–±–∞–≤–ª—è–π CHECK, DEFAULT, UNIQUE ‚Äî –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
* ‚úÖ –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π WHERE –≤ UPDATE –∏ DELETE, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—å –≤—Å—ë
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π LIMIT + OFFSET –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
* ‚úÖ –ò–Ω–¥–µ–∫—Å–∏—Ä—É–π –ø–æ–ª—è, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ JOIN, WHERE, ORDER BY
* ‚úÖ –î–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–π –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö ‚Äî –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–ª–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π EXPLAIN ANALYZE –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
* ‚úÖ –•—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ–¥ –≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º
* ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–ª—è staging/production
* ‚úÖ –ü—Ä–∏–º–µ–Ω—è—Ç—å ALTER SYSTEM SET –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
* ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–æ–ª–∏-–≥—Ä—É–ø–ø—ã (read_only, admin)
* ‚úÖ –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ pg_catalog, information_schema
* ‚úÖ –í–Ω–µ–¥—Ä—è—Ç—å RBAC (role-based access control)
* ‚úÖ –ò–Ω–¥–µ–∫—Å–∏—Ä—É–π –ø–æ–ª—è, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ WHERE, JOIN, ORDER BY
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π EXPLAIN –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∏–Ω–¥–µ–∫—Å
* ‚úÖ –ù–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–π –≤—Å—ë –ø–æ–¥—Ä—è–¥ ‚Äî —ç—Ç–æ –∑–∞–º–µ–¥–ª–∏—Ç INSERT/UPDATE
* ‚úÖ –î–ª—è GIN ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ ANALYZE –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π EXPLAIN ANALYZE –ø–µ—Ä–µ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
* ‚úÖ –°—Ä–∞–≤–Ω–∏ Seq Scan vs Index Scan
* ‚úÖ –í–∫–ª—é—á–∞–π BUFFERS, TIMING –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π WITH –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
* ‚úÖ –í–ª–æ–∂–µ–Ω–Ω—ã–µ CTE ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
* ‚ö†Ô∏è CTE ‚Äî —ç—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –±–∞—Ä—å–µ—Ä: PostgreSQL –Ω–µ –≤—Å–µ–≥–¥–∞ "–≤–ª–∏–≤–∞–µ—Ç" –∏—Ö –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞–Ω
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π pg_basebackup + standby.signal –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π —Ä–µ–ø–ª–∏–∫–∏
* ‚úÖ –ù–∞—Å—Ç—Ä–æ–π archive_mode = on –∏ archive_command –¥–ª—è WAL-–∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
* ‚úÖ –•—Ä–∞–Ω–∏ WAL –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º SSD-–¥–∏—Å–∫–µ
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Patroni, Stolon, Repmgr –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ failover
* ‚úÖ –î–ª—è –ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ ‚Äî —Å–ª–µ–¥–∏ –∑–∞ pg_replication_slots –∏ pg_stat_subscription
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π FORCE ROW LEVEL SECURITY –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç—ã
* ‚úÖ –•—Ä–∞–Ω–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö (up/down)
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π current_setting() –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, app.user_id)
* ‚úÖ –†–∞–∑–¥–µ–ª—è–π —Ä–æ–ª–∏: reader, writer, admin, auditor
* ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π —á–µ—Ä–µ–∑ SET ROLE –∏ EXPLAIN
* ‚úÖ –†–∞–∑–¥–µ–ª—è–π —Ä–æ–ª–∏: readonly, writer, admin, replicator
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –≥—Ä—É–ø–ø—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º
* ‚úÖ –•—Ä–∞–Ω–∏ —Ä–æ–ª–∏ –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö (up/down)
* ‚úÖ –ù–µ –¥–∞–≤–∞–π SUPERUSER, –µ—Å–ª–∏ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å CREATEDB, CREATEROLE
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π pg_roles, pg_auth_members, information_schema.role_table_grants –¥–ª—è –∞—É–¥–∏—Ç–∞
* ‚úÖ –ù–∞—Å—Ç—Ä–æ–π autovacuum –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫—É (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü)
* ‚úÖ –£–≤–µ–ª–∏—á—å shared_buffers, work_mem, effective_cache_size –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π EXPLAIN ANALYZE, pg_stat_statements –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫–∏
* ‚úÖ –•—Ä–∞–Ω–∏ WAL –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º SSD-–¥–∏—Å–∫–µ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –∑–∞–ø–∏—Å–∏
* ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞–π VACUUM FULL –Ω–∞ –∞—Ä—Ö–∏–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π REPEATABLE READ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, READ COMMITTED ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
* ‚úÖ –°–ª–µ–¥–∏ –∑–∞ autovacuum, –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π pg_stat_activity, pg_locks, pg_stat_user_tables –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
* ‚úÖ –î–ª—è SERIALIZABLE ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π serialization_failure —á–µ—Ä–µ–∑ retry
* ‚úÖ –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π EXPLAIN –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å—Ç–æ–ª–±—Ü–æ–≤ –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Flyway, Liquibase) –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
* ‚úÖ –î–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü ‚Äî ALTER TABLE ... ALTER COLUMN ... TYPE ... USING —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
* ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É ‚Äî –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å –≤ maintenance window
* ‚úÖ –†–∞–∑–¥–µ–ª—è–π —Å—Ö–µ–º—ã: raw, staging, analytics, audit
* ‚úÖ –•—Ä–∞–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ CI/CD (Flyway, Liquibase)
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π pg_stat_statements, EXPLAIN ANALYZE –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π
* ‚úÖ –î–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ ‚Äî –ª–æ–≥–∏—Ä—É–π TG_OP, TG_TABLE_NAME, NEW, OLD
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π tablespaces –¥–ª—è:
*
    * SSD vs HDD —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
*
    * –ê—Ä—Ö–∏–≤–Ω—ã—Ö vs –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö
*
    * –ò–Ω–¥–µ–∫—Å–æ–≤ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Ç–∞–±–ª–∏—Ü
* ‚úÖ –•—Ä–∞–Ω–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ pg_default, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ ‚Äî –≤ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö
* ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å pg_stat_user_tables, pg_tablespace, pg_stat_bgwriter
* ‚úÖ –ù–µ —Ä–∞–∑–º–µ—â–∞–π WAL –≤ tablespace ‚Äî –¥–ª—è –Ω–µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π SSD –ª—É—á—à–µ
* ‚úÖ –í–∫–ª—é—á–∏ pg_stat_statements –∏ auto_explain –≤ postgresql.conf
* ‚úÖ –ù–∞—Å—Ç—Ä–æ–π log_min_duration_statement = 500 –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π EXPLAIN (ANALYZE, BUFFERS) –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫–∏
* ‚úÖ –•—Ä–∞–Ω–∏ WAL, –¥–∞–Ω–Ω—ã–µ –∏ –ª–æ–≥–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¥–∏—Å–∫–∞—Ö
* ‚úÖ –ù–∞—Å—Ç—Ä–æ–π pgbouncer –¥–ª—è connection pooling
* ‚úÖ –•—Ä–∞–Ω–∏ –±—ç–∫–∞–ø—ã –Ω–∞ –≤–Ω–µ—à–Ω–µ–º –¥–∏—Å–∫–µ –∏–ª–∏ –≤ –æ–±–ª–∞–∫–µ
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π cron –∏–ª–∏ pgBackRest –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
* ‚úÖ –î–ª—è –±–æ–ª—å—à–∏—Ö –±–∞–∑ ‚Äî pg_basebackup + WAL-–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
* ‚úÖ –î–ª—è CI/CD ‚Äî pg_dump –≤ custom –∏–ª–∏ directory —Ñ–æ—Ä–º–∞—Ç–µ
* ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ (restore test)
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π materialized views –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –æ—Ç—á—ë—Ç–æ–≤
* ‚úÖ –•—Ä–∞–Ω–∏ ETL-–ª–æ–≥–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (etl_runs, etl_errors)
* ‚úÖ –†–∞–∑–¥–µ–ª—è–π staging/raw/analytics —Å—Ö–µ–º—ã
* ‚úÖ –ù–∞—Å—Ç—Ä–æ–π pg_stat_statements, auto_explain, pgbouncer
* ‚úÖ –í–Ω–µ–¥—Ä–∏ CI/CD –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π (Flyway/Liquibase) –∏ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ (Airflow/GitHub Actions)

–ò—Ç–æ–≥–∏

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è          | –ö–ª—é—á–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è                                                          |
|--------------------|----------------------------------------------------------------------------|
| **–°–µ—Ç—å**           | Firewall, VPN, TLS, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π `pg_hba.conf`.                            |
| **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** | SCRAM‚ÄëSHA‚Äë256, MFA, –ø–∞—Ä–æ–ª—å‚Äë–ø–æ–ª–∏—Ç–∏–∫–∞.                                       |
| **–†–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø** | Least‚Äëprivilege —Ä–æ–ª–∏, GRANT/REVOKE, RLS, connection limits.                |
| **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã**   | –¢—Ä–∏–≥–≥–µ—Ä‚Äë–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ DML –≤–Ω–µ –æ–∫–Ω–∞, statement‚Äëtimeout.                        |
| **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**     | TLS, –¥–∏—Å–∫‚Äë—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ–ª–æ–Ω–∫–æ–≤–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ.                               |
| **–ê—É–¥–∏—Ç**          | `pgaudit`, —Ç—Ä–∏–≥–≥–µ—Ä‚Äë–ª–æ–≥, –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ SIEM.                                   |
| **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è**     | 2 –ª–æ–∫–∞–ª—å–Ω—ã–µ + 1 –æ–±–ª–∞—á–Ω–∞—è, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è + –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è, Patroni/auto‚Äëfailover. |
| **–ë—ç–∫–∞–ø—ã**         | Daily base‚Äëbackup + WAL‚Äë–∞—Ä—Ö–∏–≤, PITR, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.              |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**     | Replication lag, connections, disk space, anomalous logins.                |
| **OS/–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä**   | Hardening, SELinux/AppArmor, root‚Äëless, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.                        |
| **–ü—Ä–æ—Ü–µ–¥—É—Ä—ã**      | DR‚Äë—Ç–µ—Å—Ç, incident‚Äëresponse playbook, security‚Äëscan.                        |

###  –§–∞–π–ª –¥–ª—è Primary (Machine A)
````version: "3.9"

networks:
  pgnet:
    driver: bridge

volumes:
  primary_data:

services:
  primary:
    image: postgres:15-alpine
    container_name: pg-primary
    restart: unless-stopped
    environment:
      POSTGRES_PASSWORD: secret          # –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –Ω–∞ –æ–±–µ–∏—Ö –º–∞—à–∏–Ω–∞—Ö
      POSTGRES_USER: postgres
      POSTGRES_DB: mydb
    ports:
      - "5432:5432"                      # –Ω–∞—Ä—É–∂–Ω—ã–π –ø–æ—Ä—Ç 5432
    networks:
      - pgnet
    volumes:
      - primary_data:/var/lib/postgresql/data
    command: >
      -c wal_level=replica
      -c max_wal_senders=10
      -c wal_keep_size=128MB
      -c hot_standby=on
      -c listen_addresses='*'
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "postgres"]
      interval: 5s
      timeout: 5s
      retries: 5
````
### –§–∞–π–ª –¥–ª—è Replica (Machine B)
````
version: "3.9"

networks:
  pgnet:
    driver: bridge

volumes:
  replica_data:

services:
  replica:
    image: postgres:15-alpine
    container_name: pg-replica
    restart: unless-stopped
    environment:
      POSTGRES_PASSWORD: secret          # —Ç–æ—Ç –∂–µ –ø–∞—Ä–æ–ª—å, —á—Ç–æ –∏ –Ω–∞ –º–∞—Å—Ç–µ—Ä–µ
      POSTGRES_USER: postgres
      POSTGRES_DB: mydb
    ports:
      - "5433:5432"                      # –Ω–∞—Ä—É–∂–Ω—ã–π –ø–æ—Ä—Ç 5433 (—á—Ç–µ–Ω–∏–µ –∏–∑–≤–Ω–µ)
    networks:
      - pgnet
    depends_on:
      # –∑–¥–µ—Å—å –º—ã –ø—Ä–æ—Å—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø–æ—Å–ª–µ —Ç–æ–≥–æ,
      # –∫–∞–∫ Docker‚Äëengine –Ω–∞ —ç—Ç–æ–π –º–∞—à–∏–Ω–µ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤; —Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
      # –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä–∞ –¥–µ–ª–∞–µ—Ç—Å—è –≤ `primary_conninfo`.
      - dummy
    volumes:
      - replica_data:/var/lib/postgresql/data
    command: >
      -c hot_standby=on
      -c primary_conninfo='host=<IP‚ÄëPRIMARY> port=5432 user=postgres password=secret sslmode=prefer'
      -c recovery_target_timeline='latest'
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "postgres", "-p", "5432"]
      interval: 5s
      timeout: 5s
      retries: 5

  # Dummy —Å–µ—Ä–≤–∏—Å –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ —á—Ç–æ–±—ã `depends_on` –∏–º–µ–ª —Å–º—ã—Å–ª –≤ –≤–µ—Ä—Å–∏–∏ 3.x.
  dummy:
    image: alpine
    command: ["sleep","infinity"]
````